#!/bin/bash -e

# check the package list in a chroot against a reference.

LC_COLLATE=POSIX

if [ $(id -u) != 0 ]; then
	echo "You must be root to run this script, sorry."
	exit 1
fi

USAGE_STRING="${0##*/} <chroot>"
. /usr/share/sbuild/common_functions
parse_arg $1

tfile1="$(tempfile)"
tfile2="$(tempfile)"

grep-status -F Status -s Package ' installed' "$CHROOT/var/lib/dpkg/status" | awk '{print $2}' | sort >"$tfile1"

sort "$CHROOT/../ref-$DIST" >"$tfile2"

echo "DELETE             ADD"
echo "============================"
diff -u "$tfile1" "$tfile2" |
	tail -n +3 |
	grep ^[+-] |
	sed -e 's/^-//' -e "s/^+/                   /" |
	sort

rm -f "$tfile1" "$tfile2"

